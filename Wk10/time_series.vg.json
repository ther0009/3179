{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Bulk-billing (%) over time â€” filter by State & Demography",
  "data": {
    "url": "https://raw.githubusercontent.com/ther0009/3179/refs/heads/main/Wk10/bulkbillingbyageandstate.csv"
  },

  "width": 860,
  "height": 260,

  "params": [
    {
      "name": "stateSel",
      "value": "NSW",
      "bind": {
        "input": "select",
        "name": "State: ",
        "options": ["NSW","Vic","Qld","SA","WA","Tas","NT","ACT"]
      }
    },
    {
      "name": "demoSel",
      "value": "0-15",
      "bind": {
        "input": "select",
        "name": "Age Range: ",
        "options": ["0-15","16-64","65+"]
      }
    },
    {
      "name": "yearSel",
      "value": 2025,
      "bind": {
        "input": "range",
        "min": 2015,
        "max": 2025,
        "step": 1,
        "name": "Year: "
      }
    }
  ],

  "transform": [
    { "filter": "datum.State === stateSel" },
    { "filter": "datum['Demography value'] === demoSel" },
    { "filter": "datum.Metric === 'Bulk-billing rate'" },

    {
      "fold": [
        "Jan-2015","Feb-2015","Mar-2015","Apr-2015","May-2015","Jun-2015","Jul-2015","Aug-2015","Sep-2015","Oct-2015","Nov-2015","Dec-2015",
        "Jan-2016","Feb-2016","Mar-2016","Apr-2016","May-2016","Jun-2016","Jul-2016","Aug-2016","Sep-2016","Oct-2016","Nov-2016","Dec-2016",
        "Jan-2017","Feb-2017","Mar-2017","Apr-2017","May-2017","Jun-2017","Jul-2017","Aug-2017","Sep-2017","Oct-2017","Nov-2017","Dec-2017",
        "Jan-2018","Feb-2018","Mar-2018","Apr-2018","May-2018","Jun-2018","Jul-2018","Aug-2018","Sep-2018","Oct-2018","Nov-2018","Dec-2018",
        "Jan-2019","Feb-2019","Mar-2019","Apr-2019","May-2019","Jun-2019","Jul-2019","Aug-2019","Sep-2019","Oct-2019","Nov-2019","Dec-2019",
        "Jan-2020","Feb-2020","Mar-2020","Apr-2020","May-2020","Jun-2020","Jul-2020","Aug-2020","Sep-2020","Oct-2020","Nov-2020","Dec-2020",
        "Jan-2021","Feb-2021","Mar-2021","Apr-2021","May-2021","Jun-2021","Jul-2021","Aug-2021","Sep-2021","Oct-2021","Nov-2021","Dec-2021",
        "Jan-2022","Feb-2022","Mar-2022","Apr-2022","May-2022","Jun-2022","Jul-2022","Aug-2022","Sep-2022","Oct-2022","Nov-2022","Dec-2022",
        "Jan-2023","Feb-2023","Mar-2023","Apr-2023","May-2023","Jun-2023","Jul-2023","Aug-2023","Sep-2023","Oct-2023","Nov-2023","Dec-2023",
        "Jan-2024","Feb-2024","Mar-2024","Apr-2024","May-2024","Jun-2024","Jul-2024","Aug-2024","Sep-2024","Oct-2024","Nov-2024","Dec-2024",
        "Jan-2025","Feb-2025","Mar-2025","Apr-2025","May-2025","Jun-2025"
      ],
      "as": ["month","value"]
    },

    { "calculate": "toNumber(replace(datum.value, '%', ''))", "as": "rate" },
    { "calculate": "toDate(datum.month)", "as": "monthDate" },
    { "calculate": "year(datum.monthDate)", "as": "year" },
    { "filter": "datum.year === yearSel" }
  ],

  "mark": { "type": "line", "point": true },

  "encoding": {
    "x": { "field": "monthDate", "type": "temporal", "title": "Month" },
    "y": {
      "field": "rate",
      "type": "quantitative",
      "title": "Bulk-billing (%)",
      "scale": { "domain": [0, 100] }
    },
    "color": { "value": "#3366cc" },
    "tooltip": [
      { "field": "State", "title": "State" },
      { "field": "Demography value", "title": "Age Range" },
      { "field": "monthDate", "type": "temporal", "title": "Period", "format": "%b %Y" },
      { "field": "rate", "type": "quantitative", "title": "Bulk-billing (%)", "format": ".1f" }
    ]
  }
}
